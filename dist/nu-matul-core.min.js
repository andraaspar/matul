!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.matul=t():e.matul=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{FragmentComp:()=>n,Spread:()=>r,VComponent:()=>d,VElement:()=>i,VPlaceholder:()=>a,VText:()=>s,applyHandler:()=>B,createElement:()=>R,getIsLogging:()=>p,m:()=>b,setIsLogging:()=>h});const n=(e,t)=>t.children;class r{constructor(e){this.items=e}}class i{constructor(e,t,n,r){this.name=e,this.props=t,this.children=n,this.trusted=r}}class s{constructor(e){this.text=e}}class o{constructor(e){this.items=e,this.itemByKey=new Map,this.count=0;let t=e.length;for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof d||r instanceof i)null!=r.key&&this.itemByKey.set(r.key,r);else{if(r instanceof s||r instanceof o){this.itemByKey.clear();break}t--}}if(this.itemByKey.size&&this.itemByKey.size<t)throw new Error(`[qqf32k] Duplicate / missing keys in list: actual count = ${this.itemByKey.size} < expected count = ${t}`)}updateCount(){this.count=0;for(const e of this.items)e instanceof o||e instanceof d?this.count+=e.count:(e instanceof i||e instanceof s)&&this.count++}}class a{constructor(e){this.value=e}}function l(e){const t=[];for(const n of e)if(n instanceof o||n instanceof d||n instanceof i||n instanceof s||n instanceof a)t.push(n);else if(n instanceof r)for(const e of l(n.items))t.push(e);else Array.isArray(n)?t.push(new o(l(n))):["string","number","bigint"].includes(typeof n)?t.push(new s(n+"")):t.push(new a(n));return t}class d{constructor(e,t,n){this.renderInternal=e,this.props=t,this.children=n,this.count=0,this.state={},this.internal={props:t,state:this.state,children:n}}render(){this.renderedVirtual=this.renderInternal(void 0,this.internal),Array.isArray(this.renderedVirtual)||(this.renderedVirtual=this.renderedVirtual?[this.renderedVirtual]:[]),this.renderedVirtual=l(this.renderedVirtual)}updateCount(){this.count=0;for(const e of this.renderedVirtual)e instanceof o||e instanceof d?this.count+=e.count:(e instanceof i||e instanceof s)&&this.count++}}function u({handler:e,parent:t,index:n,virtual:r}){if(r instanceof o)for(let i=0;i<r.items.length;i++)n=u({handler:e,parent:t,index:n,virtual:r.items[i]});else if(r instanceof d){if(n=x({handler:e,parent:t,index:n,virtuals:r.renderedVirtual,oldVirtuals:void 0,parentIsBeingRemoved:!1}),r.internal.onadded)try{r.internal.onadded()}catch(e){console.error(e)}if(r.internal.onupdated)try{r.internal.onupdated(!0)}catch(e){console.error(e)}}else if(r instanceof i){if(r.result=e.add({parent:t,index:n,virtual:r}),n++,null==r.trusted&&x({parent:r.result,handler:e,index:0,virtuals:r.children,oldVirtuals:void 0,parentIsBeingRemoved:!1}),r.ref)try{r.ref(r.result)}catch(e){console.error(e)}}else r instanceof s&&(r.result=e.add({parent:t,index:n,virtual:r}),n++);return n}function c({handler:e,parent:t,index:n,virtual:r,parentIsBeingRemoved:a}){if(r instanceof o)for(let i=0;i<r.items.length;i++)c({handler:e,parent:t,index:n,virtual:r.items[i],parentIsBeingRemoved:a});else if(r instanceof d){if(r.internal.onremove)try{r.internal.onremove()}catch(e){console.error(e)}x({handler:e,parent:t,index:n,virtuals:void 0,oldVirtuals:r.renderedVirtual,parentIsBeingRemoved:a}),r.internal.isRemoved=!0}else if(r instanceof i){if(x({handler:e,parent:r.result,index:0,virtuals:void 0,oldVirtuals:r.children,parentIsBeingRemoved:!0}),e.remove({parent:t,index:n,result:r.result,virtual:r,parentIsBeingRemoved:a}),r.ref)try{r.ref(void 0)}catch(e){console.error(e)}}else r instanceof s&&e.remove({parent:t,index:n,result:r.result,virtual:r,parentIsBeingRemoved:a})}let f=!0;function h(e){f=e}function p(){return f}function m(e,t,n){for(let r=0;r<t.length;r++){const i=t[r];if(i===n)return e;i instanceof o||i instanceof d?e+=i.count:e++}throw new Error("[qyswku] Deep index not found.")}function y({handler:e,parent:t,index:n,oldIndex:r,virtual:a}){if(a instanceof o)for(let i=0;i<a.items.length;i++){const s=y({handler:e,parent:t,index:n,oldIndex:r,virtual:a.items[i]});n=s.index,r=s.oldIndex}else if(a instanceof d)for(let i=0;i<a.renderedVirtual.length;i++){const s=y({handler:e,parent:t,index:n,oldIndex:r,virtual:a.renderedVirtual[i]});n=s.index,r=s.oldIndex}else(a instanceof i||a instanceof s)&&(n!==r&&e.move({parent:t,oldIndex:r,index:n,result:a.result,virtual:a}),n<=r&&r++,n++);return{index:n,oldIndex:r}}function v({handler:e,parent:t,index:n,virtual:r,oldVirtual:a}){let l=n;if(r instanceof o){const s=a;if(r.itemByKey.size&&s.itemByKey.size){const o=[];for(let n=0;n<s.items.length;n++){const a=s.items[n];if(a instanceof d||a instanceof i){const i=r.itemByKey.get(a.key);i?(l=v({handler:e,parent:t,index:l,virtual:i,oldVirtual:a}),o.push(i)):c({handler:e,parent:t,index:l,virtual:s.items[n],parentIsBeingRemoved:!1})}}for(let n=0;n<r.items.length;n++){const a=r.items[n];a instanceof d||a instanceof i?s.itemByKey.get(a.key)||(l=u({handler:e,parent:t,index:l,virtual:a}),o.push(a)):p()&&console.warn("[qysuqc] Invalid list item!",r.items,n,a)}let a=!0;for(;a;){a=!1;for(let i=0;i<o.length-1;i++){const s=o[i],l=o[i+1];if(r.items.indexOf(s)-r.items.indexOf(l)>0){const r=m(n,o,s);y({handler:e,parent:t,index:r,oldIndex:r+(s instanceof d?s.count:1),virtual:l}),o[i]=l,o[i+1]=s,a=!0}}}}else p()&&r.items.length&&s.items.length&&console.warn("[qyt810] List without a key!",r),l=x({handler:e,parent:t,index:l,virtuals:r.items,oldVirtuals:s.items,parentIsBeingRemoved:!1})}else if(r instanceof d){if(l=x({handler:e,parent:t,index:l,virtuals:r.renderedVirtual,oldVirtuals:a.renderedVirtual,parentIsBeingRemoved:!1}),r.internal.onupdated)try{r.internal.onupdated(!1)}catch(e){console.error(e)}}else r instanceof i?(r.debug=a.debug,null!=r.debug&&--r.debug,r.result=a.result,e.update({result:r.result,virtual:r,oldVirtual:a}),l++,x({handler:e,parent:r.result,index:0,virtuals:r.children,oldVirtuals:a.children,parentIsBeingRemoved:!1})):r instanceof s&&(r.result=a.result,e.update({result:r.result,virtual:r,oldVirtual:a}),l++);return l}function g(e,t){return e instanceof o&&t instanceof o||e instanceof d&&t instanceof d&&e.renderInternal===t.renderInternal||e instanceof i&&t instanceof i&&e.name===t.name&&e.trusted===t.trusted||e instanceof s&&t instanceof s}function x({handler:e,parent:t,index:n,virtuals:r,oldVirtuals:i,parentIsBeingRemoved:s}){if(r)if(i){for(let o=r.length;o<i.length;o++)c({handler:e,parent:t,index:n,virtual:i[o],parentIsBeingRemoved:s});for(let s=0;s<r.length;s++){const o=r[s],a=i[s];g(o,a)?n=v({handler:e,parent:t,index:n,virtual:o,oldVirtual:a}):(a&&c({handler:e,parent:t,index:n,virtual:a,parentIsBeingRemoved:!1}),n=u({handler:e,parent:t,index:n,virtual:o}))}}else for(let i=0;i<r.length;i++)n=u({handler:e,parent:t,index:n,virtual:r[i]});else if(i)for(let r=0;r<i.length;r++)c({handler:e,parent:t,index:n,virtual:i[r],parentIsBeingRemoved:s});return n}function V(e,t){if(e instanceof o){const n=t;if(n&&e.itemByKey.size&&n.itemByKey.size)for(let t=0;t<e.items.length;t++){const r=e.items[t];if(r instanceof d||r instanceof i){const e=n.itemByKey.get(r.key);e&&g(r,e)?V(r,e):V(r,void 0)}}else I(e.items,t?.items);e.updateCount()}else if(e instanceof d){t instanceof d&&(e.debug=t.debug,null!=e.debug&&--e.debug,e.internal=t.internal,e.internal.props=e.props,e.state=e.internal.state,e.internal.children=e.children),e.render();try{I(e.renderedVirtual,t?.renderedVirtual)}catch(n){if(!e.internal.onerror)throw n;try{e.internal.onerror(n),e.render(),I(e.renderedVirtual,t?.renderedVirtual)}catch(e){throw console.error(e),n}}e.updateCount()}else e instanceof i&&I(e.children,t?.children)}function I(e,t){if(e)if(t)for(let n=0;n<e.length;n++){const r=e[n],i=t[n];g(r,i)?V(r,i):V(r,void 0)}else for(let t=0;t<e.length;t++)V(e[t],void 0)}function B(e,t){const n=t?l(t):void 0,r=e.getVirtuals();n&&I(n,r),x({handler:e,parent:e.getRoot(),index:0,virtuals:n,oldVirtuals:r,parentIsBeingRemoved:!1}),e.setVirtuals(n)}function b(e,t,n){const r=Array.isArray(t)?{}:t||{},s=Array.isArray(t)?t:n||[],o=s?l(Array.isArray(s)?s:[s]):[];if("function"==typeof e){const t=r.key,n=r.debug;delete r.key,delete r.debug;const i=new d(e,r,o);return i.key=t,i.debug=n,i}{const t=r.key,n=r.ref,s=r.debug,a=r.__UNSAFE_trust__;delete r.key,delete r.ref,delete r.debug,delete r.__UNSAFE_trust__;const l=new i(e,r,o,a);return l.key=t,l.ref=n,l.debug=s,l}}function R(e,t,...n){return b(e,t,n)}return t})()));